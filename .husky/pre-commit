#!/bin/sh

echo "ğŸ” Running pre-commit quality gates..."

echo "ğŸ§ª Running tests..."
npm test || exit 1

echo "ğŸ” Running linting..."
npm run lint || exit 1

echo "ğŸ” Running type checking..."
npm run type-check || exit 1

echo "ğŸ” Checking for TODO/FIXME comments..."
if grep -r "TODO\|FIXME" src/ --exclude-dir=node_modules; then
  echo "âŒ TODO/FIXME comments found in source code"
  exit 1
fi

echo "ğŸ” Checking for @ts-ignore comments..."
if grep -r "@ts-ignore" src/ --exclude-dir=node_modules; then
  echo "âŒ @ts-ignore comments found. Fix types instead."
  exit 1
fi

echo "ğŸ” Checking for console.log statements..."
if grep -r "console\.log" src/ --exclude-dir=node_modules; then
  echo "âŒ console.log statements found in source code"
  exit 1
fi

echo "ğŸ” Checking for large files..."
find . -type f -size +1M | grep -v node_modules | grep -v .git
if [ $? -eq 0 ]; then
  echo "âŒ Large files detected. Please review before committing."
  exit 1
fi

echo "ğŸ” Basic secret detection..."
if grep -r "password\|secret\|key\|token" src/ --exclude-dir=node_modules | grep -v "test\|mock\|example"; then
  echo "âš ï¸  Potential secrets found. Please review."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
